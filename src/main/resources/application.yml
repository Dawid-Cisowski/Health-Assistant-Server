spring:
  application:
    name: health-assistant-event-collector

  jackson:
    serialization:
      write-dates-as-timestamps: false

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  datasource:
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: ${SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE:10}
      minimum-idle: ${SPRING_DATASOURCE_HIKARI_MINIMUM_IDLE:2}
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        jdbc:
          time_zone: UTC
          batch_size: 50
        order_inserts: true
        order_updates: true

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    validate-on-migrate: true
    lock-retry-count: 50

  modulith:
    events:
      jdbc:
        schema-initialization:
          enabled: true
      republish-outstanding-events-on-restart: true

  servlet:
    multipart:
      max-file-size: 8MB
      max-request-size: 8MB
      file-size-threshold: 0

  cache:
    type: caffeine
    caffeine:
      spec: expireAfterWrite=${NONCE_CACHE_TTL_SEC:600}s,maximumSize=10000

  ai:
    google:
      genai:
        api-key: ${GEMINI_API_KEY}
        model: ${GEMINI_MODEL:gemini-3-pro-preview}
        chat:
          options:
            temperature: 1.5

server:
  port: 8080
  shutdown: graceful
  tomcat:
    max-http-form-post-size: 10MB
  error:
    include-message: always
    include-binding-errors: always

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  prometheus:
    metrics:
      export:
        enabled: true

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method

logging:
  level:
    root: INFO
    com.healthassistant: DEBUG
    org.springframework.web: INFO
    org.hibernate: WARN

app:
  hmac:
    devices-json: ${HMAC_DEVICES_JSON}
    tolerance-seconds: ${HMAC_TOLERANCE_SEC:600}
  nonce:
    cache-ttl-seconds: ${NONCE_CACHE_TTL_SEC:600}
  batch:
    max-events: 100
  google-fit:
    api-url: ${GOOGLE_FIT_API_URL}
    oauth-url: ${GOOGLE_FIT_OAUTH_URL}
    client-id: ${GOOGLE_FIT_CLIENT_ID}
    client-secret: ${GOOGLE_FIT_CLIENT_SECRET}
    refresh-token: ${GOOGLE_FIT_REFRESH_TOKEN}
    device-id: ${GOOGLE_FIT_DEVICE_ID:google-fit}
  assistant:
    max-iterations: ${ASSISTANT_MAX_ITERATIONS:5}

